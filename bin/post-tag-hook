#! /bin/bash -eu

# This can be run manually inside the (git) source tree.



if [ ${CENTRALREPO-x} = x ];
then
    if git remote show | grep origin; then
	CENTRALREPO=origin;
    elif git remote show | grep maruska; then
	CENTRALREPO=maruska;
    else
	# only 1 line?
	# don't fail for this?  Or should fail?
	echo "no central repository defined, so cannot push anywhere" >&2
	exit 1;
    fi
fi

# : ${CENTRALREPO=origin}

: ${GBP_TAG=$(git describe)}
: ${GBP_BRANCH=$(git name-rev --name-only  HEAD)}

git push $CENTRALREPO $GBP_TAG || echo "'git push' failed for the tag $GBP_TAG"
git push $CENTRALREPO $GBP_BRANCH || echo "'git push' failed for the branch $GBP_BRANCH"
#GBP_BRANCH
#GBP_SHA1
